## Как задеплоить бота в Yandex Cloud Functions

А также в подобных serverless решениях, например AWS Lambda.


### Подготовка кода к работе с вебхуками

- Мы будем принимать вебхуки, надо начать везде отвечать именно в них.
- Если у нас где-то есть синхронные действия, избавиться от них - всё должно быть async.
- Убедиться, что нигде не "спим" и не ждём долго. Важно успеть ответить в вебхук за короткое время.
- Чтение secret token для вебхука из переменных окружения.


### Подготовка кода к запуску в Cloud Functions

#### Принудительно собирать зависимости в `requirements.txt`

Для этого:
- устанавливаем pre-commit;
- переходим на uv - есть миграция с poetry;
- настраиваем в pre-commit вызов `uv-export`, чтобы при изменении зависимостей автоматически экспортировать заново;


#### Знакомимся с форматом работы в Cloud Functions

- как загрузить код;
- как мы принимаем запрос;
- какие варианты для отправки ответа у нас есть - почему нам может быть интересен ответ в base64;
- как храним секреты;
- зачем нужен API gateway;


#### Описываем свою webhook обертку для работы с Cloud Functions

Нам нужно давать ответ в определенном формате.
Поддержим именно такой формат ответа, для этого сделаем свою реализацию.

Также нужно учитывать работу с asyncio,
для этого необходимо по-особенному запускать выполнение кода.


### Запуск в Yandex Cloud Functions

- создаем платежный аккаунт, если ещё нет;
- заводим папку под наш сервис;
- заводим сервисный аккаунт;
- добавляем секреты: токен бота и секрет для вебхука;
- создаём API gateway;
- заводим cloud function и делаем её публичной;
- загружаем код через zip архив;


### Мониторинг Cloud Function

- где читать логи;
- где смотреть метрики;
